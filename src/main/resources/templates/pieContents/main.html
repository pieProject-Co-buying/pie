<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="mainPageCarousel">
	<div id="headerCarousel" class="carousel slide overflow-hidden"
		data-ride="carousel">
		<div class="carousel-inner">
			<div class="carousel-item hyej-h100vh active"></div>
			<div class="carousel-item hyej-h100vh"></div>
			<div class="carousel-item hyej-h100vh"></div>
		</div>
		<button class="carousel-control-prev" type="button"
			data-target="#headerCarousel" data-slide="prev">
			<span class="carousel-control-prev-icon" aria-hidden="true"></span> <span
				class="sr-only">Previous</span>
		</button>
		<button class="carousel-control-next" type="button"
			data-target="#headerCarousel" data-slide="next">
			<span class="carousel-control-next-icon" aria-hidden="true"></span> <span
				class="sr-only">Next</span>
		</button>
	</div>
</div>


<!-- main fragment -->
<div th:fragment="mainPageContents">
	<!-- ###############################################
secion1 #sec1 - 우리동네 공동구매 영역
############################################### -->
	<section class="pie-section-py">
		<div class="container">
			<div class="row">
				<div class="col">
					<div
						class="d-flex align-items-center justify-content-between w-100">
						<h1 class="mb-5 mt-5 text-center text-sm-left">대리공구(가제)</h1>
						<a class="btn border"> <small>더보기</small>
						</a>
					</div>

					<div class="card-columns">
						<div class="card">
							<img src="imgs/img1.jpg" class="card-img-top" alt="...">
							<div class="card-body">
								<h5 class="card-title">Card title that wraps to a new line</h5>
								<p class="card-text">This is a longer card with supporting
									text below as a natural lead-in to additional content. This
									content is a little bit longer.</p>
								<p class="card-text">
									<small class="text-muted">Last updated 3 mins ago</small>
								</p>
							</div>
						</div>
						<div class="card">
							<img src="imgs/img2.jpg" class="card-img-top" alt="...">
							<div class="card-body">
								<h5 class="card-title">Card title</h5>
								<p class="card-text">This card has supporting text below as
									a natural lead-in to additional content.</p>
								<p class="card-text">
									<small class="text-muted">Last updated 3 mins ago</small>
								</p>
							</div>
						</div>
						<div class="card">
							<img src="imgs/img3.jpg" class="card-img-top" alt="...">
							<div class="card-body">
								<h5 class="card-title">Card title</h5>
								<p class="card-text">This card has supporting text below as
									a natural lead-in to additional content.</p>
								<p class="card-text">
									<small class="text-muted">Last updated 3 mins ago</small>
								</p>
							</div>
						</div>
						<div class="card">
							<img src="imgs/img4.jpg" class="card-img-top" alt="...">
							<div class="card-body">
								<h5 class="card-title">Card title</h5>
								<p class="card-text">This card has supporting text below as
									a natural lead-in to additional content.</p>
								<p class="card-text">
									<small class="text-muted">Last updated 3 mins ago</small>
								</p>
							</div>
						</div>
						<div class="card">
							<img src="imgs/img5.jpg" class="card-img-top" alt="...">
							<div class="card-body">
								<h5 class="card-title">Card title</h5>
								<p class="card-text">This card has supporting text below as
									a natural lead-in to additional content.</p>
								<p class="card-text">
									<small class="text-muted">Last updated 3 mins ago</small>
								</p>
							</div>
						</div>
						<div class="card">
							<img src="imgs/img6.jpg" class="card-img-top" alt="...">
							<div class="card-body">
								<h5 class="card-title">Card title</h5>
								<p class="card-text">This card has supporting text below as
									a natural lead-in to additional content.</p>
								<p class="card-text">
									<small class="text-muted">Last updated 3 mins ago</small>
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</section>


	<!-- ###############################################
secion2 #sec2 - 대리공구 영역
############################################### -->


	<section id="sec2" class="pie-bg-lightgray pie-section-py">

		<div class="container ">

			<div class="d-flex align-items-center justify-content-between w-100 my-4">
				<h1
					class="mb-5 mt-5 text-center text-sm-left font-weight-bolder pie-c-red">대리공구(가제)</h1>
				<a class="btn btn-light" href="proxyBuyProducts"> <small>┼</small>
				</a>
			</div>
			<th:block th:if="${list==null||list.size()==0}">
				<div class="row">
					<div class="col">
						<hr class="my-5" />
						<p class="lead py-5">현재 작성된 글이 없습니다.</p>
						<hr class="my-5" />
					</div>
				</div>
			</th:block>


			<th:block th:if="${list!=null && list.size()!=0}">
				<div class="row hyej-best-gallery align-items-center">
					<div class="col-lg-6 col-md-8 mb-3 mb-md-2">
						<img src="imgs/bestMark.png" alt="best" id="bestMark"
							class="position-absolute" />
						<div class="container-fluid hyej-customCard pt-1 bg-white shadow">
							<div class="row border-bottom">
								<div class="col-12 px-5 py-3 d-flex align-items-center">
									<img th:src="@{'imgs/profiles/'+${list[0].getPr_profileImg()}}"
										class=" border rounded-circle pie-profilePic-mid align-self-center"
										id="bestProfileImg" alt=>
									<div class="pl-3 pie-view-text pie-omitted d-flex flex-column">
										<small class="m-0 font-weight-bold"
											th:text="${list[0].getPr_nickname()}" id="bestNickName">아이디</small>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col p-0">
									<div id="proxyMainCarousel" class="carousel slide"
										data-ride="carousel">
										<ol class="carousel-indicators">
											<th:block
												th:each="i : ${#numbers.sequence(0,list[0].getPr_productImgs().length-1)}">
												<li data-target="#proxyMainCarousel"
													th:attr="data-slide-to=${i}"></li>
											</th:block>
										</ol>
										<div class="carousel-inner">
											<th:block th:each="img : ${list[0].getPr_productImgs()}">
												<div class="carousel-item">
													<img th:src="@{'imgs/test/'+${img}}" class="d-block w-100"
														alt="...">
												</div>
											</th:block>

										</div>
										<button class="carousel-control-prev" type="button"
											data-target="#proxyMainCarousel" data-slide="prev">
											<span class="carousel-control-prev-icon" aria-hidden="true"></span>
											<span class="sr-only">Previous</span>
										</button>
										<button class="carousel-control-next" type="button"
											data-target="#proxyMainCarousel" data-slide="next">
											<span class="carousel-control-next-icon" aria-hidden="true"></span>
											<span class="sr-only">Next</span>
										</button>
									</div>
								</div>
							</div>
							<div class="row px-5 pt-5">
								<div class="col">
									<p class="mb-1 pie-c-red font-weight-bolder">
										<small id="bestCategory" th:text="${list[0].getPr_category()}"></small>
									</p>
									<h4 id="bestTitle" class="text-truncate mb-4"
										th:text="${list[0].getPr_title()}"></h4>
									<div id="bestContent" class="hyej-text-truncate">
										<p th:text="${list[0].getPr_content()}"></p>
									</div>
									<div class="">
										<small id="bestTags"> <th:block
												th:if="${list[0].getPr_tags()!=null}">
												<th:block
													th:each="i: ${#numbers.sequence(1, list[0].getPr_tags()?.length - 1)}">
													<span class="badge badge-light"
														th:text="|#${list[0].getPr_tags()[i]}|">#태그</span>
												</th:block>
											</th:block>
										</small>
									</div>
									<div class="d-flex justify-content-end">
										<div class="d-flex align-items-center">
											<span class="pie-heart-icon active pie-icons mr-2"></span> <span
												id="bestLike" th:text=${list[0].getPr_like()}></span>
										</div>
										<div class="d-flex align-items-center mx-3">
											<span class="pie_view-icon active pie-icons mr-2"></span> <span
												id="bestHit" th:text=${list[0].getPr_hit()}></span>
										</div>
										<div class="d-flex align-items-center">
											<span class="pie-man-icon active pie-icons mr-2"></span> <span
												id="bestNow" th:text=${list[0].getPr_personnelNow()}></span>
											<span>/</span> <span id="bestMax"
												th:text=${list[0].getPr_personnelMax()}></span>
										</div>
									</div>
								</div>
							</div>
							<div class="row px-5 py-5">
								<div class="col">
									<a th:href="@{'viewProxyBoard?num='+${list[0].getPr_num()}}"
										class="btn pie-btn-red btn-block" id="bestBtn">보러가기</a>
								</div>
							</div>

						</div>
					</div>
					<div class="col-lg-6 col-md-4 px-5">
						<div class="row no-gutters justify-content-center bests">
							<th:block th:each="board : ${list}">
								<div class="col-md-12 col-2 mx-2 mx-md-0 mb-md-4 bestProduct">
									<div class="hyej-custom-img-box position-relative">
										<img
											th:src="@{'/imgs/test/' + ${board.getPr_productImg().substring(0,board.getPr_productImg().indexOf('/'))}}"
											alt="" class="shadow"/>
										<div class="hyej-cover">
											<p class="d-none d-lg-block m-0" th:text="${board.getPr_category()}"></p>
											<h3 class="d-none d-lg-block text-truncate" th:text="${board.getPr_title()}"></h3>
										</div>
									</div>
								</div>
							</th:block>
						</div>
					</div>
				</div>
			</th:block>
		</div>
	</section>


	<section class="pie-section-py overflow-hidden">

		<div class="container">
			<div class="row">
				<div class="col">
					<h1 class="mb-5 mt-5 text-center text-sm-left">서비스 공유</h1>
				</div>
			</div>
		</div>

		<div class="row position-relative hyej-carousel-custom pb-5 mb-5">
			<div class="col pb-5 mb-5">
				<div class="owl-carousel owl-theme">
					<div class="item">
						<h4>
							<img src="imgs/netflix2.png" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/watcha.jpg" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/xbox.jpg" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/ridibooks.jpg" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/youtube.webp" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4 class="">
							<img src="imgs/disney.png" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/steam.jpg" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/spotify.jpg" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/nintendoOnline.jpeg" alt="" class="img-fluid">
						</h4>
					</div>
					<div class="item">
						<h4>
							<img src="imgs/milli.jpg" alt="" class="img-fluid">
						</h4>
					</div>
				</div>
			</div>
		</div>

	</section>


	<script type="text/javascript" th:inline="javascript">
		var list = /*[[${list}]]*/[];
		console.log(list);
	</script>
	<script>
		$(function() {
			$("#proxyMainCarousel").find(".carousel-item").eq(0).addClass(
					"active");
			$("#proxyMainCarousel").find("li").eq(0).addClass("active");

			$(".bests").find(".bestProduct").eq(0).hide();

			$(".bests")
					.find(".bestProduct")
					.click(
							function() {
								$(".bests").find(".bestProduct").show();
								let idx = $(this).index();
								$("#bestProfileImg").attr(
										"src",
										'imgs/profiles/'
												+ list[idx].pr_profileImg);
								$("#bestNickName").text(list[idx].pr_nickname);
								$("#bestTitle").text(list[idx].pr_title);
								$("#bestLike").text(list[idx].pr_like);
								$("#bestHit").text(list[idx].pr_hit);
								$("#bestNow").text(list[idx].pr_personnelNow);
								$("#bestMax").text(list[idx].pr_personnelMax);
								$("#bestCategory").text(list[idx].pr_category)

								$("#bestTags").empty();

								console.log(list[idx].pr_tags);
								if (list[idx].pr_tags != null) {
									for (i = 1; i < list[idx].pr_tags.length; i++) {
										$("#bestTags").append(
												'<span class="badge badge-light">#'
														+ list[idx].pr_tags[i]
														+ '</span>')
									}
								}

								let el = list[idx].pr_content;
								const newText = el.replace(/<[^>]*>?/g, '');

								console.log(newText);

								$("#bestContent")
										.html("<p>" + newText + "</p>");
								$("#bestBtn").attr(
										"href",
										'viewProxyBoard?num='
												+ list[idx].pr_num);
								$("#proxyMainCarousel").find(
										".carousel-indicators").empty();
								for (i = 0; i < list[idx].pr_productImgs.length; i++) {
									$("#proxyMainCarousel")
											.find(".carousel-indicators")
											.append(
													'<li data-target="#proxyMainCarousel" data-slide-to="'+i+'"></li>');
								}
								$("#proxyMainCarousel").find("li").eq(0)
										.addClass("active");
								$("#proxyMainCarousel").find(".carousel-inner")
										.empty();
								for (i = 0; i < list[idx].pr_productImgs.length; i++) {
									$("#proxyMainCarousel")
											.find(".carousel-inner")
											.append(
													'<div class="carousel-item"><img src="imgs/test/'+list[idx].pr_productImgs[i]+'" class="d-block w-100" alt="..."></div>');
								}
								$("#proxyMainCarousel").find(".carousel-item")
										.eq(0).addClass("active");
								$(this).hide();
							})
		})
	</script>


</div>

</html>