<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.pie.pieProject.DAO.ITownBuyBoardDao">


	<select id="listDao"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from townBuyBoard order by to_num desc

	</select>


	<!-- 프리미엄 목록 가져올 쿼리문 -->
	<select id="listPremiumDao"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">

		select * from townBuyBoard where to_premium = #{param1}

	</select>


	<select id="viewDao"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from townBuyBoard where to_num = #{param1}

	</select>


	<update id="updateDao">

		<!-- update townBuyBoard set to_category = #{to_category}, to_title = #{to_title}, 
			to_content = #{to_content}, to_price = #{to_price}, to_personnelMax = #{to_personnelMax}, 
			to_deadLine = TO_DATE(#{to_deadLine}, 'YYYY-MM-DD') where to_num = #{to_num} -->


		update townBuyBoard set to_category=#{to_category},
		to_title=#{to_title}, to_content=#{to_content},
		to_productImg=#{to_productImg}, to_tag=#{to_tag},
		to_deadLine=TO_DATE(#{to_deadLine}, 'YYYY-MM-DD'),
		to_personnelMax=#{to_personnelMax}, to_priceTotal=#{to_priceTotal},
		to_pricePer=#{to_pricePer}, to_ip=#{to_ip}, to_updateDay=sysdate,
		to_address = #{to_address} where
		to_num=#{to_num}

	</update>


	<delete id="deleteDao">

		delete townBuyBoard where to_num = #{param1}

	</delete>

	<select id="searchDao"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from townBuyBoard where to_title like
		'%${param1}%' or
		to_content like '%${param1}%' or to_tag like '%${param1}%'
	</select>


	<select id="searchDao" resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from townBuyBoard where to_title like '%${param1}%' or
		to_content like '%${param1}%'
		
		
<!--		    SELECT *
		    FROM townBuyBoard
		    WHERE 
		    <if test="to_category == null">
		        to_title like '%${param1}%' or to_content like '%${param1}%'
		    </if>
		    <if test="to_category != null">
		        to_title like '%${param1}%' or to_content like '%${param1}%'
		        AND
		        (to_category IS NULL OR to_category = #{param2})
		    </if>		
				-->
				
	</select>
	
	<select id="searchCateDao"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from townBuyBoard where to_category = #{param2} and (to_title like
		'%${param1}%' or
		to_content like '%${param1}%' or to_tag like '%${param1}%')

	</select>


	<select id="categoryDao"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from townBuyBoard where to_category = #{param1}
	</select>

	<select id="categoryDaoNum"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from (select * from townBuyBoard where to_category =
		#{param1})
		where ROWNUM <![CDATA[ <= ]]>
		#{param2}
	</select>

	<insert id="writeDao">
		insert into townBuyBoard values(
		to_num.nextval,
		#{to_id},
		#{to_nickname},
		#{to_category},
		#{to_premium},
		#{to_title},
		#{to_content},
		#{to_profileImg},
		#{to_productImg},
		0,
		#{to_tag},
		#{to_address},
		'1',
		sysdate,
		sysdate,
		TO_DATE(#{to_deadLine},
		'YYYY-MM-DD'),
		#{to_personnelMax},
		1,
		#{to_priceTotal},
		#{to_pricePer},
		#{to_ip},
		0
		)
	</insert>


	<select id="listLocal"
		resultType="com.pie.pieProject.DTO.TownBuyBoardDto">
		select * from townBuyBoard where to_address like
		'${param1}%' and
		to_process= '1'
	</select>

	<update id="updatePer">
		update townBuyBoard set to_personnelNow =
		to_personnelNow+1 where to_num = #{param1}
	</update>

	<update id="updateProcess">
		update townBuyBoard set to_process = 0 where to_num =
		#{param1}
	</update>


	<update id="updateHit">
		update townBuyBoard set to_hit = to_hit+1 where
		to_num = #{param1}
	</update>


</mapper>